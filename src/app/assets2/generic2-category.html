<h3>{{categoryName}}</h3>

<input type="checkbox" id="accountCbx" name="accountCbx" [(ngModel)]="gd.showAllAccounts" (ngModelChange)="gd.updateAccountsVisibility()" title="Toggle visibility of all accounts"/>
<label for="accountCbx">Accounts</label>
&nbsp;&nbsp;&nbsp;
<input type="checkbox" id="fieldCbx" [(ngModel)]="gd.showAllFields" (ngModelChange)="gd.updateFieldsVisibility()" title="Toggle visibility of all fields"/>
<label for="fieldCbx">Fields</label>
&nbsp;&nbsp;&nbsp;
<input type="checkbox" id="hiddenFieldsCbx" [(ngModel)]="gd.wantHiddenFields" (ngModelChange)="gd.updateHiddenFieldsVisibility()" title="Show hidden fields"/>
<label for="hiddenFieldsCbx">Show "hidden" fields</label>

<br>
<table>
    <tr class="category">
    	<td>{{categoryName}}</td>
    	<td>
     		<input class="category" type="number" [value]="gd.getCategorySum()" size="8" readonly>
    	</td>
    	<td>
    	</td>
    </tr>
	<template ngFor let-subcatobj [ngForOf]="gd.currentSubcategories">
        <tr class="subcategory">
        	<td>
         		<input class="subcategory" type="string" [(ngModel)]="category[subcatobj.subcat].label" size="30">
         	</td>
        	<td>
         		<input class="subcategory" type="number" [value]="gd.getSubcategorySum(subcatobj.subcat)" size="8" readonly>
        	</td>
	    	<td>
				<button (click)="gd.toggleAccountVisibility(subcatobj.subcat)" title="Toggle visibility of accounts for this subcategory">\/</button>
    		</td>
        </tr>
	    <template ngFor let-actndx="index" [ngForOf]="gd.currentAccounts[subcatobj.subcat]">
	        <tr class="account" *ngIf="gd.isAccountVisible(subcatobj.subcat)">
	        	<td>
         			<input class="account" type="string" [(ngModel)]="category[subcatobj.subcat].accounts[actndx].accountName.val" size="30">
	        	</td>
	         	<td>
	         		<input class="account" *ngIf="category[subcatobj.subcat].accounts[actndx].monthlyAmount" type="number" [(ngModel)]="category[subcatobj.subcat].accounts[actndx].monthlyAmount.val" (blur)="verify()" size="8">
	         	</td>
				<td>
					<button (click)="gd.toggleFieldVisibility(subcatobj.subcat,actndx)" title="Toggle visibility of fields for this account">\/</button>
				</td>
			</tr>
		    <template ngFor let-fieldobj [ngForOf]="gd.currentFields[subcatobj.subcat][actndx]">
		        <tr class="field" *ngIf="gd.isAccountVisible(subcatobj.subcat) && gd.isFieldVisible(subcatobj.subcat,actndx)">
					<td>
						<input class="field" type="string" [(ngModel)]="category[subcatobj.subcat].accounts[actndx][fieldobj.field].label" size="30">
					</td>
		         	<td>
		         		<template ngIf="category[subcatobj.subcat].accounts[actndx][field]">
							<input *ngIf="gd.isString(category[subcatobj.subcat].accounts[actndx][fieldobj.field].val)" class="field" type="text" [(ngModel)]="category[subcatobj.subcat].accounts[actndx][fieldobj.field].val" (blur)="verify()" size="30">
							<input *ngIf="gd.isNumber(category[subcatobj.subcat].accounts[actndx][fieldobj.field].val)" class="field" type="number" [(ngModel)]="category[subcatobj.subcat].accounts[actndx][fieldobj.field].val" (blur)="verify()" size="30">
							<input *ngIf="gd.isBoolean(category[subcatobj.subcat].accounts[actndx][fieldobj.field].val)" class="field" type="checkbox" [(ngModel)]="category[subcatobj.subcat].accounts[actndx][fieldobj.field].val" (blur)="verify()">
		         		</template>
		         	</td>
		         	<td>
		         		<!--
		         		<input class="field" type="checkbox" [(ngModel)]="category[subcatobj.subcat].accounts[actndx][field].isRequired" (blur)="verify()"> -->
		         	</td>
		        </tr>
		    </template>
	    </template>
	</template>
</table>

<br><br>
Manage Items
<br><br>
<table>
    <tr>
		<td>Action</td>
		<td>
			<select [(ngModel)]="im.selectedAction" (change)="im.onActionChange()">
				<option value="Add">Add</option>
				<option value="Delete">Delete</option>
			</select>
		</td>
    </tr>
	<tr>
		<td>Item</td>
		<td>
			<select [(ngModel)]="im.selectedItem" (change)="im.onItemChange()">
				<option value="Subcategory">Subcategory</option>
				<option value="Account">Account</option>
				<option value="Field">Field</option>
			</select>
		</td>
    </tr>

   	<tr>
		<td>Subcategory</td>
		<td>
			<select [(ngModel)]="im.selectedSubcategory" (change)="im.onSubcategoryChange()">
				<option *ngFor="let subcatobj of im.subcatList" [value]="subcatobj.subcat">{{subcatobj.label}}</option>
			</select>
    		<input *ngIf="im.selectedSubcategory == 'custom'" type="text" [(ngModel)]="im.customSubcategory" size="15" title="Name of custom Subcategory attribute">
		</td>
    </tr>
   	<tr *ngIf="im.selectedAction == 'Add' || im.selectedItem == 'Account' || im.selectedItem == 'Field'">
		<td>Account</td>
		<td>
			<select [(ngModel)]="im.selectedAccount" (change)="im.onAccountChange()">
				<option *ngFor="let accountName of im.accountList" [value]="accountName">{{accountName}}</option>
			</select>
    		<input *ngIf="im.selectedAccount == 'custom'" type="text" [(ngModel)]="im.customAccount" size="15" title="Name of custom Account attribute">
		</td>
    </tr>
   	<tr *ngIf="im.selectedAction == 'Add' || im.selectedItem == 'Field'">
		<td>Field</td>
		<td>
			<select *ngIf="im.selectedAction == 'Add'" [(ngModel)]="im.selectedFieldSelection" (change)="im.onFieldSelectionChange()" title="method of field name choice">
				<option value="Account type">Account type</option>
				<option value="Field name">Field name</option>
			</select>
			<select [(ngModel)]="im.selectedField" (change)="im.onFieldChange()">
				<option *ngFor="let fieldobj of im.fieldList" [value]="fieldobj.field">{{fieldobj.label}}</option>
			</select>
    		<input *ngIf="im.selectedField == 'custom'" type="text" [(ngModel)]="im.customField" size="15" title="Name of custom Field attribute">
		</td>
    </tr>
</table>

<br>
<button (click)="im.performAction()">Perform Action</button>

<br><br>
<div *ngFor="let message of messages">{{message}}</div>
